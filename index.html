<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventory Pro â€“ Mobile</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body { font-family: 'Inter', sans-serif; background:#f8fafc; }

/* MOBILE ONLY */
@media (min-width: 768px) {
  body::before {
    content: "This application is optimized for mobile devices only.";
    position: fixed;
    inset: 0;
    background: #020617;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    font-size: 1rem;
    text-align: center;
    padding: 2rem;
  }
  body > * { display: none !important; }
}
</style>
</head>

<body class="min-h-screen">

<!-- LOADER -->
<div id="loader" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-50">
  <div class="animate-spin rounded-full h-10 w-10 border-4 border-slate-200 border-t-blue-600 mb-4"></div>
  <p class="text-sm text-slate-600 font-semibold">Loading RM.xlsx</p>
</div>

<!-- HEADER -->
<header class="sticky top-0 bg-white border-b border-slate-200 z-40">
  <div class="p-4 flex items-center gap-3">
    <div class="bg-blue-600 text-white w-9 h-9 rounded-lg flex items-center justify-center">
      <i class="fa-solid fa-cube"></i>
    </div>
    <div>
      <h1 class="font-bold text-slate-800">Inventory Pro</h1>
      <p class="text-xs text-slate-500">Mobile Master List</p>
    </div>
  </div>
</header>

<main class="p-4 space-y-4">

  <!-- GRAPH -->
  <div class="bg-white p-4 rounded-2xl border border-slate-200">
    <canvas id="statusChart" height="140"></canvas>
  </div>

  <!-- SEARCH + FILTERS -->
  <div class="bg-white p-4 rounded-2xl border border-slate-200 space-y-3">
    <input id="searchInput" type="text" placeholder="Search item, code, vendor..."
      class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm focus:ring-2 focus:ring-blue-500 outline-none">

    <select id="vendorFilter" class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm">
      <option value="">All Vendors</option>
    </select>

    <select id="categoryFilter" class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm">
      <option value="">All Categories</option>
    </select>

    <select id="statusFilter" class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm">
      <option value="">All Status</option>
    </select>
  </div>

  <!-- SEARCH PROMPT -->
  <div id="searchPrompt" class="text-center py-20 text-slate-400">
    <i class="fa-solid fa-magnifying-glass text-4xl mb-4"></i>
    <p class="text-sm font-semibold">Search to view inventory</p>
  </div>

  <!-- GRID -->
  <div id="grid" class="grid grid-cols-1 gap-4 hidden"></div>

  <div id="noResults" class="hidden text-center text-slate-400 py-10">
    <i class="fa-solid fa-ghost text-3xl mb-2"></i>
    <p class="text-sm">No matching items</p>
  </div>

</main>

<script>
const FILE = "RM.xlsx";
let items = [];
let chart;

fetch(FILE + "?v=" + Date.now())
  .then(r => r.arrayBuffer())
  .then(b => {
    const wb = XLSX.read(b, {type:'array'});
    const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
    parseData(data);
    document.getElementById('loader').style.display = "none";
  });

function parseData(data) {
  items = data.map((r,i)=>({
    id:i+1,
    name:r['Item_Name'] || r['Item Name'] || 'Unnamed',
    code:r['Item_Code'] || r['Item Code'] || '-',
    vendor:r['Vendor List 2::Vendor_Name'] || r['Vendor'] || 'Unknown',
    cat:r['Material List::Material_Detail'] || r['Category'] || 'General',
    status:r['Status'] || 'Unknown'
  }));

  populateFilters();
  renderChart();
}

function populateFilters() {
  const v = new Set(), c = new Set(), s = new Set();
  items.forEach(i => { v.add(i.vendor); c.add(i.cat); s.add(i.status); });

  fill('vendorFilter', v);
  fill('categoryFilter', c);
  fill('statusFilter', s);
}

function fill(id,set) {
  const el = document.getElementById(id);
  [...set].sort().forEach(v=>{
    const o=document.createElement('option');
    o.value=o.textContent=v;
    el.appendChild(o);
  });
}

function renderChart() {
  const active = items.filter(i=>i.status.toLowerCase().includes('use')).length;
  const disc = items.length - active;

  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('statusChart'),{
    type:'doughnut',
    data:{labels:['Active','Discontinued'],datasets:[{data:[active,disc]}]},
    options:{cutout:'70%',plugins:{legend:{position:'bottom'}}}
  });
}

document.querySelectorAll('#searchInput,#vendorFilter,#categoryFilter,#statusFilter')
.forEach(e=>e.addEventListener('input',applyFilters));

function applyFilters() {
  const q = searchInput.value.toLowerCase();
  if(q.length < 2) {
    grid.classList.add('hidden');
    searchPrompt.classList.remove('hidden');
    return;
  }

  searchPrompt.classList.add('hidden');
  grid.classList.remove('hidden');
  grid.innerHTML = '';
  let visible = 0;

  items.forEach(i=>{
    if(
      (!vendorFilter.value || i.vendor===vendorFilter.value) &&
      (!categoryFilter.value || i.cat===categoryFilter.value) &&
      (!statusFilter.value || i.status===statusFilter.value) &&
      (`${i.name} ${i.code} ${i.vendor}`.toLowerCase().includes(q))
    ){
      visible++;
      grid.innerHTML += `
      <div class="bg-white border border-slate-200 rounded-2xl p-4">
        <span class="text-xs font-bold ${i.status.toLowerCase().includes('use')?'text-green-600':'text-red-600'}">${i.status}</span>
        <h3 class="font-bold text-slate-800 mt-1">${i.name}</h3>
        <p class="text-xs text-slate-500 font-mono">${i.code}</p>
        <div class="text-xs text-slate-600 mt-2">
          <div><i class="fa-solid fa-store mr-1"></i>${i.vendor}</div>
          <div><i class="fa-solid fa-layer-group mr-1"></i>${i.cat}</div>
        </div>
      </div>`;
    }
  });

  noResults.classList.toggle('hidden', visible !== 0);
}
</script>
</body>
</html>
